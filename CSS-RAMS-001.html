<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Assessment & Method Statement - CSS-RAMS-001</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 13px;
            line-height: 1.5;
            background: #f5f7fa;
        }

        .header {
            text-align: center;
            border: 2px solid #1e3a8a;
            padding: 20px;
            margin-bottom: 20px;
            background: linear-gradient(to bottom, #ffffff 0%, #f8fafc 100%);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .header img {
            max-width: 280px;
            max-height: 140px;
            margin-bottom: 15px;
        }

        .header h1 {
            color: #1e3a8a;
            margin: 10px 0;
            font-size: 22px;
            font-weight: bold;
        }

        .header-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
            text-align: left;
        }

        .info-field {
            display: flex;
            flex-direction: column;
        }

        .info-field label {
            font-weight: bold;
            font-size: 11px;
            color: #64748b;
            text-transform: uppercase;
        }

        .info-field input {
            padding: 6px;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            font-size: 12px;
        }

        .full-width {
            grid-column: span 2;
        }

        .tabs {
            margin-bottom: 0;
        }

        .tab-nav {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 2px;
        }

        .tab-button {
            padding: 10px;
            border: none;
            background: linear-gradient(to bottom, #ffffff 0%, #f1f5f9 100%);
            color: #475569;
            font-size: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            border-radius: 6px 6px 0 0;
        }

        .tab-button:hover:not(.active) {
            background: linear-gradient(to bottom, #f8fafc 0%, #e2e8f0 100%);
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
        }

        .tab-content {
            display: none;
            padding: 25px;
            background: white;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .tab-content.active {
            display: block;
        }

        .section-title {
            color: #1e3a8a;
            font-size: 15px;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 3px solid #3b82f6;
            padding-bottom: 8px;
            background: linear-gradient(to right, #f0f9ff 0%, transparent 100%);
            padding-left: 10px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 12px;
            color: #374151;
        }

        /* Info Corner Boxes */
        .info-corner {
            position: fixed;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 12px 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .info-corner:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(30, 58, 138, 0.4);
        }

        .info-corner.top-left {
            top: 0;
            left: 0;
            border-bottom-right-radius: 8px;
        }

        .info-corner.top-right {
            top: 0;
            right: 0;
            border-bottom-left-radius: 8px;
        }

        .info-panel {
            display: none;
            position: fixed;
            top: 60px;
            background: white;
            border: 2px solid #1e3a8a;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            z-index: 999;
            min-width: 300px;
            max-width: 400px;
        }

        .info-panel.show {
            display: block;
        }

        .info-panel.left {
            left: 20px;
        }

        .info-panel.right {
            right: 20px;
        }

        .info-panel h3 {
            margin: 0 0 15px 0;
            color: #1e3a8a;
            font-size: 16px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 8px;
        }

        .info-panel p {
            margin: 8px 0;
            font-size: 12px;
            line-height: 1.6;
        }

        .info-panel .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #64748b;
            padding: 5px;
        }

        .info-panel .close-btn:hover {
            color: #1e3a8a;
        }

        .consultant-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f0f9ff;
            border-radius: 4px;
            border: 1px solid #0ea5e9;
            margin-top: 15px;
        }

        .consultant-info strong {
            color: #1e3a8a;
        }

        .consultant-info a {
            color: #0ea5e9;
            text-decoration: none;
            font-weight: 600;
            font-size: 11px;
        }

        .consultant-info a:hover {
            text-decoration: underline;
        }

        .form-control, select, textarea {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid #cbd5e1;
            font-size: 12px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .form-control:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 12px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }

        .checkbox-group, .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 6px;
        }

        .checkbox-item, .radio-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .textarea-large {
            min-height: 80px;
            resize: vertical;
            font-family: inherit;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #1e3a8a;
            border: 2px solid #1e3a8a;
        }

        .btn-secondary:hover {
            background: #1e3a8a;
            color: white;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #e2e8f0;
        }

        .progress-indicator {
            text-align: center;
            margin: 10px 0;
            font-size: 11px;
            color: #64748b;
            font-weight: 600;
        }

        .info-box {
            background: linear-gradient(to right, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid #0ea5e9;
            padding: 12px;
            margin: 12px 0;
            border-radius: 6px;
            font-size: 12px;
        }

        .warning-box {
            background: linear-gradient(to right, #fff3cd 0%, #fffbeb 100%);
            border-left: 4px solid #ffc107;
            padding: 12px;
            margin: 12px 0;
            border-radius: 6px;
            font-size: 12px;
        }

        .danger-box {
            background: linear-gradient(to right, #fee2e2 0%, #fef2f2 100%);
            border-left: 4px solid #dc2626;
            padding: 12px;
            margin: 12px 0;
            border-radius: 6px;
            font-size: 12px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 11px;
        }

        table th {
            background: #1e3a8a;
            color: white;
            padding: 8px;
            text-align: left;
            font-weight: bold;
        }

        table td {
            padding: 6px;
            border: 1px solid #cbd5e1;
        }

        table tr:nth-child(even) {
            background: #f8fafc;
        }

        .add-row-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(30, 58, 138, 0.3);
        }

        .add-row-btn:hover {
            background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.4);
        }

        .delete-row-btn {
            padding: 4px 8px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }

        .delete-row-btn:hover {
            background: #dc2626;
        }

        .risk-matrix {
            display: grid;
            grid-template-columns: 120px repeat(3, 1fr);
            gap: 2px;
            margin: 15px 0;
            font-size: 10px;
        }

        .risk-header {
            background: #1e3a8a;
            color: white;
            padding: 8px;
            text-align: center;
            font-weight: bold;
        }

        .risk-cell {
            padding: 6px;
            border: 1px solid #cbd5e1;
            text-align: center;
        }

        .risk-label {
            background: #f1f5f9;
            padding: 6px;
            font-weight: bold;
            text-align: center;
        }

        .risk-low {
            background: #dcfce7;
        }

        .risk-medium {
            background: #fef3c7;
        }

        .risk-high {
            background: #fee2e2;
        }

        @media print {
            body {
                max-width: none;
                padding: 10px;
            }
            .action-buttons, .nav-buttons, .tab-nav {
                display: none !important;
            }
            .tab-content {
                display: block !important;
                page-break-after: always;
            }
        }
    </style>
</head>
<body>
    <!-- Information Corner Tabs -->
    <div class="info-corner top-left" onclick="toggleInfoPanel('left')">
        üìã Form Info
    </div>
    <div class="info-corner top-right" onclick="toggleInfoPanel('right')">
        ‚ÑπÔ∏è Help & Guidance
    </div>

    <!-- Information Panels -->
    <div class="info-panel left" id="info-panel-left">
        <button class="close-btn" onclick="closeInfoPanel('left')">√ó</button>
        <h3>Form Information</h3>
        <p><strong>Form Reference:</strong> CSS-RAMS-001</p>
        <p><strong>Version:</strong> 1.0</p>
        <p><strong>Purpose:</strong> Risk Assessment & Method Statement for construction and maintenance activities</p>
        <p><strong>Completion Time:</strong> 30-60 minutes</p>
        <p><strong>Confidentiality:</strong> All information is strictly confidential</p>
        <p><strong>Data Storage:</strong> Form auto-saves to browser localStorage</p>
    </div>

    <div class="info-panel right" id="info-panel-right">
        <button class="close-btn" onclick="closeInfoPanel('right')">√ó</button>
        <h3>Help & Guidance</h3>
        <p><strong>Navigation:</strong> Click tabs to navigate between sections</p>
        <p><strong>Risk Assessment:</strong> Assess hazards before and after control measures</p>
        <p><strong>Control Measures:</strong> Select from library or add custom measures</p>
        <p><strong>PPE Requirements:</strong> Check all required protective equipment with EN standards</p>
        <p><strong>Save/Load:</strong> Use Save Progress to store data locally, Load Saved to retrieve</p>
        <p><strong>Support:</strong> Contact HSQE Consultant for assistance</p>
    </div>

    <div class="header">
        <img src="https://page.gensparksite.com/v1/base64_upload/65982c0f83dc8cbbe9020c7b0cf61502" alt="Common Sense Safety Logo">
        <h1>RISK ASSESSMENT & METHOD STATEMENT</h1>
        <div style="font-size: 12px; color: #64748b; margin-bottom: 15px;">Common Sense Safety | CSS-RAMS-001</div>
        
        <div class="header-info">
            <div class="info-field">
                <label>Document Reference:</label>
                <input type="text" id="doc_ref" class="form-control" placeholder="CSS-RAMS-001">
            </div>
            <div class="info-field">
                <label>Revision Number:</label>
                <input type="text" id="revision" class="form-control" placeholder="00">
            </div>
            <div class="info-field">
                <label>Date Prepared:</label>
                <input type="date" id="date_prepared" class="form-control">
            </div>
            <div class="info-field">
                <label>Prepared By:</label>
                <input type="text" id="prepared_by" class="form-control" placeholder="Name">
            </div>
            <div class="info-field full-width">
                <label>HSQE Consultant:</label>
                <div class="consultant-info">
                    <strong>Jeremy Bromley</strong>
                    <span>|</span>
                    <a href="mailto:jeremy@commonsensesafety.org" title="Click to email Jeremy Bromley">View Contact Details</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons moved to bottom of document -->

    <div class="tabs">
        <div class="tab-nav">
            <div class="tab-button active" onclick="showTab(1)">1. Project Details</div>
            <div class="tab-button" onclick="showTab(2)">2. Activity Description</div>
            <div class="tab-button" onclick="showTab(3)">3. Hazard Identification</div>
            <div class="tab-button" onclick="showTab(4)">4. Risk Assessment</div>
            <div class="tab-button" onclick="showTab(5)">5. PPE Requirements</div>
            <div class="tab-button" onclick="showTab(6)">6. Plant & Equipment</div>
            <div class="tab-button" onclick="showTab(7)">7. Materials</div>
            <div class="tab-button" onclick="showTab(8)">8. Sequence of Work</div>
            <div class="tab-button" onclick="showTab(9)">9. Emergency Procedures</div>
            <div class="tab-button" onclick="showTab(10)">10. Environmental Controls</div>
            <div class="tab-button" onclick="showTab(11)">11. Sign-off & Approval</div>
        </div>
        <div class="progress-indicator">
            <span id="progress-text">Tab 1 of 11</span>
        </div>
    </div>

    <!-- Tab 1: Project Details -->
    <div class="tab-content active" id="tab1">
        <div class="section-title">1. Project Details</div>
        
        <div class="form-row">
            <div class="form-group">
                <label>Project Name:</label>
                <input type="text" id="project_name" class="form-control">
            </div>
            <div class="form-group">
                <label>Client Name:</label>
                <input type="text" id="client_name" class="form-control">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Site Location/Address:</label>
                <textarea id="site_location" class="form-control" rows="2"></textarea>
            </div>
            <div class="form-group">
                <label>Job Reference Number:</label>
                <input type="text" id="job_ref" class="form-control">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Start Date:</label>
                <input type="date" id="start_date" class="form-control">
            </div>
            <div class="form-group">
                <label>Estimated Duration:</label>
                <input type="text" id="duration" class="form-control" placeholder="e.g., 4 weeks">
            </div>
        </div>

        <div class="section-title" style="margin-top: 25px;">Key Contacts</div>

        <div class="form-row">
            <div class="form-group">
                <label>Project Manager:</label>
                <input type="text" id="project_manager" class="form-control">
            </div>
            <div class="form-group">
                <label>Contact Number:</label>
                <input type="tel" id="pm_phone" class="form-control">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Site Supervisor:</label>
                <input type="text" id="site_supervisor" class="form-control">
            </div>
            <div class="form-group">
                <label>Contact Number:</label>
                <input type="tel" id="supervisor_phone" class="form-control">
            </div>
        </div>

        <div class="form-group">
            <label>HSQE Consultant:</label>
            <div style="display: flex; gap: 15px; align-items: center; padding: 10px; background: #f0f9ff; border-radius: 4px;">
                <strong style="color: #1e3a8a;">Jeremy Bromley</strong>
                <span>|</span>
                <a href="mailto:jeremy@commonsensesafety.co.uk" style="color: #0ea5e9; text-decoration: none; font-weight: 600;">jeremy@commonsensesafety.co.uk</a>
            </div>
        </div>

        <div class="section-title" style="margin-top: 25px;">First Aid & Emergency</div>

        <div class="form-row">
            <div class="form-group">
                <label>Nearest A&E Hospital:</label>
                <input type="text" id="hospital_name" class="form-control" placeholder="Hospital name">
            </div>
            <div class="form-group">
                <label>Address/Postcode:</label>
                <input type="text" id="hospital_address" class="form-control">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Hospital Phone:</label>
                <input type="tel" id="hospital_phone" class="form-control">
            </div>
            <div class="form-group">
                <label>On-Site First Aider:</label>
                <input type="text" id="first_aider" class="form-control">
            </div>
        </div>

        <div class="form-group">
            <label>First Aid Kit Location:</label>
            <input type="text" id="first_aid_location" class="form-control" placeholder="e.g., All company vehicles, Site office">
        </div>

        <div class="nav-buttons">
            <button class="btn btn-secondary" disabled>‚¨Ö Previous</button>
            <button class="btn btn-primary" onclick="showTab(2)">Next ‚û°</button>
        </div>
    </div>

    <!-- Tab 2: Activity Description -->
    <div class="tab-content" id="tab2">
        <div class="section-title">2. Activity Description</div>
        
        <div class="form-group">
            <label>RAMS Title / Works to be Carried Out:</label>
            <input type="text" id="rams_title" class="form-control" placeholder="Brief title of the activity">
        </div>

        <div class="form-group">
            <label>Detailed Description of Works:</label>
            <textarea id="work_description" class="textarea-large" rows="6" placeholder="Provide a comprehensive description of the works to be undertaken..."></textarea>
        </div>

        <div class="section-title" style="margin-top: 25px;">Access & Logistics</div>

        <div class="form-group">
            <label>Delivery Method:</label>
            <textarea id="delivery_method" class="form-control" rows="2" placeholder="How will materials and equipment be delivered to site?"></textarea>
        </div>

        <div class="form-group">
            <label>Access Method:</label>
            <textarea id="access_method" class="form-control" rows="2" placeholder="How will operatives access the work areas?"></textarea>
        </div>

        <div class="section-title" style="margin-top: 25px;">Distribution List</div>

        <table id="distribution_table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Position/Company</th>
                    <th>Email Address</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input type="text" class="form-control" placeholder="Name"></td>
                    <td><input type="text" class="form-control" placeholder="Position/Company"></td>
                    <td><input type="email" class="form-control" placeholder="Email address"></td>
                    <td><button class="delete-row-btn" onclick="deleteRow(this)">Delete</button></td>
                </tr>
            </tbody>
        </table>
        <button class="add-row-btn" onclick="addDistributionRow()"><span style="font-size: 16px; color: white;">+</span> Add Person</button>

        <div class="nav-buttons">
            <button class="btn btn-secondary" onclick="showTab(1)">‚¨Ö Previous</button>
            <button class="btn btn-primary" onclick="showTab(3)">Next ‚û°</button>
        </div>
    </div>

    <!-- Tab 3: Hazard Identification -->
    <div class="tab-content" id="tab3">
        <div class="section-title">3. Hazard Identification</div>
        
        <div class="info-box">
            <strong>Instructions:</strong> Select all hazards that are relevant to this activity. These will be carried forward to the Risk Assessment section.
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0;">
            <div class="checkbox-item">
                <input type="checkbox" id="haz_slips" name="hazard">
                <label for="haz_slips">Slips, Trips & Falls</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_manual" name="hazard">
                <label for="haz_manual">Manual Handling</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_height" name="hazard">
                <label for="haz_height">Work at Height</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_excavation" name="hazard">
                <label for="haz_excavation">Excavations</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_machinery" name="hazard">
                <label for="haz_machinery">Machinery/Plant</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_lifting" name="hazard">
                <label for="haz_lifting">Lifting Equipment</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_electrical" name="hazard">
                <label for="haz_electrical">Electrical Hazards</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_fire" name="hazard">
                <label for="haz_fire">Fire Risk</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_noise" name="hazard">
                <label for="haz_noise">Noise Exposure</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_vibration" name="hazard">
                <label for="haz_vibration">Vibration</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_dust" name="hazard">
                <label for="haz_dust">Dust/Fumes</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_coshh" name="hazard">
                <label for="haz_coshh">COSHH Substances</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_confined" name="hazard">
                <label for="haz_confined">Confined Spaces</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_overhead" name="hazard">
                <label for="haz_overhead">Overhead Cables</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_underground" name="hazard">
                <label for="haz_underground">Underground Services</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_traffic" name="hazard">
                <label for="haz_traffic">Vehicle/Traffic Movement</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_public" name="hazard">
                <label for="haz_public">Public Safety</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_weather" name="hazard">
                <label for="haz_weather">Adverse Weather</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_ground" name="hazard">
                <label for="haz_ground">Ground Conditions</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_water" name="hazard">
                <label for="haz_water">Working Near Water</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_asbestos" name="hazard">
                <label for="haz_asbestos">Asbestos (Potential)</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_struck" name="hazard">
                <label for="haz_struck">Struck by Moving Objects</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_hand_tools" name="hazard">
                <label for="haz_hand_tools">Hand Tools</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="haz_other" name="hazard">
                <label for="haz_other">Other (specify below)</label>
            </div>
        </div>

        <div class="form-group">
            <label>Other Hazards (please specify):</label>
            <textarea id="other_hazards" class="form-control" rows="2"></textarea>
        </div>

        <div class="section-title" style="margin-top: 25px;">Related Risk Assessments</div>
        
        <div class="info-box">
            <strong>Instructions:</strong> Add relevant risk assessments to link to this RAMS.
        </div>

        <table id="ra_table" style="font-size: 11px;">
            <thead>
                <tr>
                    <th style="width: 50%;">Risk Assessment Title</th>
                    <th style="width: 30%;">Reference Number</th>
                    <th style="width: 20%;">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input type="text" class="form-control" placeholder="e.g., Working at Height"></td>
                    <td><input type="text" class="form-control" placeholder="e.g., RA-001"></td>
                    <td><button class="delete-row-btn" onclick="deleteRow(this)">Delete</button></td>
                </tr>
            </tbody>
        </table>
        <button class="add-row-btn" onclick="addRARow()"><span style="font-size: 16px; color: white;">+</span> Add Risk Assessment</button>

        <div class="section-title" style="margin-top: 25px;">Related COSHH Assessments</div>
        
        <div class="info-box">
            <strong>Instructions:</strong> Add relevant COSHH assessments for hazardous substances used.
        </div>

        <table id="coshh_table" style="font-size: 11px;">
            <thead>
                <tr>
                    <th style="width: 50%;">Substance/Product Name</th>
                    <th style="width: 30%;">COSHH Reference</th>
                    <th style="width: 20%;">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input type="text" class="form-control" placeholder="e.g., Cement/Concrete"></td>
                    <td><input type="text" class="form-control" placeholder="e.g., COSHH-001"></td>
                    <td><button class="delete-row-btn" onclick="deleteRow(this)">Delete</button></td>
                </tr>
            </tbody>
        </table>
        <button class="add-row-btn" onclick="addCOSHHRow()"><span style="font-size: 16px; color: white;">+</span> Add COSHH Assessment</button>

        <div class="nav-buttons">
            <button class="btn btn-secondary" onclick="showTab(2)">‚¨Ö Previous</button>
            <button class="btn btn-primary" onclick="showTab(4)">Next ‚û°</button>
        </div>
    </div>

    <!-- Tab 4: Risk Assessment & Control Measures (MERGED TABS 4 & 5) -->
    <div class="tab-content" id="tab4">
        <div class="section-title">4. Risk Assessment & Control Measures</div>
        
        <div class="info-box">
            <strong>Risk Rating System:</strong><br>
            <strong>Probability:</strong> 3=Inevitable, 2=Likely, 1=Unlikely | 
            <strong>Severity:</strong> 3=Fatal/Major, 2=Minor/Serious, 1=Slight/No Injury<br>
            <strong>Risk Score = Probability √ó Severity</strong> | 
            <span style="color: #dc2626; font-weight: bold;">6-9: INTOLERABLE</span> | 
            <span style="color: #f59e0b; font-weight: bold;">4-5: MODERATE</span> | 
            <span style="color: #10b981; font-weight: bold;">1-3: TOLERABLE</span>
        </div>

        <table style="width: 100%; font-size: 11px; margin-top: 15px;">
            <thead>
                <tr style="background: #1e3a8a; color: white;">
                    <th style="padding: 8px; width: 20%;">Hazard Description</th>
                    <th style="padding: 8px; width: 12%; text-align: center;">Initial Risk<br>(P√óS)</th>
                    <th style="padding: 8px; width: 35%;">Control Measures</th>
                    <th style="padding: 8px; width: 12%; text-align: center;">Residual Risk<br>(P√óS)</th>
                    <th style="padding: 8px; width: 15%;">Who Affected</th>
                    <th style="padding: 8px; width: 6%;"></th>
                </tr>
            </thead>
            <tbody id="risk_matrix_tbody">
                <tr>
                    <td style="padding: 8px;">
                        <select class="form-control" style="font-size: 11px; margin-bottom: 5px;">
                            <option value="">-- Select Hazard --</option>
                            <option value="custom">+ Add Custom Hazard</option>
                            <optgroup label="Physical Hazards">
                                <option value="Slips, Trips & Falls">Slips, Trips & Falls</option>
                                <option value="Working at Height">Working at Height</option>
                                <option value="Manual Handling">Manual Handling</option>
                                <option value="Machinery & Equipment">Machinery & Equipment</option>
                                <option value="Vehicle Movement">Vehicle Movement</option>
                                <option value="Confined Spaces">Confined Spaces</option>
                                <option value="Electricity">Electricity</option>
                                <option value="Noise">Noise</option>
                                <option value="Vibration">Vibration</option>
                            </optgroup>
                            <optgroup label="Environmental">
                                <option value="Weather Conditions">Weather Conditions</option>
                                <option value="Ground Conditions">Ground Conditions</option>
                                <option value="Underground Services">Underground Services</option>
                                <option value="Overhead Services">Overhead Services</option>
                            </optgroup>
                            <optgroup label="Chemical/Biological">
                                <option value="Hazardous Substances (COSHH)">Hazardous Substances (COSHH)</option>
                                <option value="Dust & Fumes">Dust & Fumes</option>
                                <option value="Asbestos">Asbestos</option>
                            </optgroup>
                        </select>
                        <input type="text" class="form-control" placeholder="Or enter custom hazard" style="font-size: 11px; display: none;" id="custom_hazard_input">
                    </td>
                    <td style="padding: 8px; text-align: center;">
                        <div style="display: flex; gap: 5px; align-items: center; justify-content: center;">
                            <select class="form-control" style="width: 50px; font-size: 11px;">
                                <option value="">P</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                            <span>√ó</span>
                            <select class="form-control" style="width: 50px; font-size: 11px;">
                                <option value="">S</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                            <div class="risk-score" style="width: 40px; height: 30px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; background: #e5e7eb; color: #6b7280;">-</div>
                        </div>
                    </td>
                    <td style="padding: 8px;">
                        <select multiple class="form-control" style="font-size: 11px; height: 100px; margin-bottom: 5px;">
                            <optgroup label="General Controls">
                                <option value="All personnel briefed on RAMS">All personnel briefed on RAMS before starting work</option>
                                <option value="Site induction completed">Site induction to be completed by all workers</option>
                                <option value="Safe system of work">Safe system of work to be implemented and monitored</option>
                                <option value="Competent personnel only">Only competent and trained personnel to carry out work</option>
                                <option value="Toolbox talks">Regular toolbox talks to be conducted</option>
                                <option value="Area cordoned off">Area to be cordoned off with barriers/signage</option>
                                <option value="Equipment inspected">Equipment to be inspected before use</option>
                                <option value="Emergency procedures">Emergency procedures to be clearly communicated</option>
                            </optgroup>
                            <optgroup label="PPE Controls">
                                <option value="Appropriate PPE worn">Appropriate PPE to be worn at all times</option>
                                <option value="Hi-vis clothing">High visibility clothing to be worn</option>
                                <option value="Safety harness">Safety harness and fall protection equipment</option>
                                <option value="Hearing protection">Hearing protection in noisy areas</option>
                                <option value="Respiratory protection">Respiratory protection where required</option>
                            </optgroup>
                            <optgroup label="Work Controls">
                                <option value="Permit to work">Permit to work system to be followed</option>
                                <option value="Method statement">Method statement to be followed</option>
                                <option value="Risk assessment">Risk assessment to be reviewed</option>
                                <option value="Supervision">Adequate supervision to be provided</option>
                                <option value="Two person operation">Two person lift/operation to be used</option>
                            </optgroup>
                        </select>
                        <input type="text" class="form-control" placeholder="+ Add custom control measure" style="font-size: 11px;">
                    </td>
                    <td style="padding: 8px; text-align: center;">
                        <div style="display: flex; gap: 5px; align-items: center; justify-content: center;">
                            <select class="form-control" style="width: 50px; font-size: 11px;">
                                <option value="">P</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                            <span>√ó</span>
                            <select class="form-control" style="width: 50px; font-size: 11px;">
                                <option value="">S</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                            <div class="risk-score" style="width: 40px; height: 30px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; background: #e5e7eb; color: #6b7280;">-</div>
                        </div>
                    </td>
                    <td style="padding: 8px;">
                        <input type="text" class="form-control" placeholder="e.g., Operatives, Public" style="font-size: 11px;">
                    </td>
                    <td style="padding: 8px; text-align: center;">
                        <button class="delete-row-btn" onclick="deleteRow(this)" style="font-size: 11px; padding: 4px 8px;">√ó</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <button class="add-row-btn" onclick="addRiskMatrixRow()"><span style="font-size: 16px; color: white;">+</span> Add Risk Assessment</button>

        <div class="nav-buttons">
            <button class="btn btn-secondary" onclick="showTab(3)">‚¨Ö Previous</button>
            <button class="btn btn-primary" onclick="showTab(5)">Next ‚û°</button>
        </div>
    </div>

    <!-- Tab 5: PPE Requirements - GRID LAYOUT -->
    <div class="tab-content" id="tab5">
        <div class="section-title">5. Personal Protective Equipment (PPE)</div>
        
        <div class="warning-box">
            <strong>‚ö†Ô∏è Legal Requirement:</strong> PPE must conform to relevant EN/UK standards and be properly maintained. Items marked with <span style="color: #dc2626;">*</span> are MANDATORY.
        </div>

        <style>
            .ppe-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 15px;
                margin-top: 20px;
            }
            .ppe-card {
                background: white;
                border: 2px solid #e2e8f0;
                border-radius: 8px;
                padding: 15px;
                transition: all 0.3s ease;
            }
            .ppe-card:hover {
                border-color: #1e3a8a;
                box-shadow: 0 4px 12px rgba(30, 58, 138, 0.15);
            }
            .ppe-card.mandatory {
                background: #fef2f2;
                border-color: #dc2626;
            }
            .ppe-header {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 10px;
            }
            .ppe-icon {
                font-size: 32px;
                min-width: 40px;
                text-align: center;
            }
            .ppe-info {
                flex: 1;
            }
            .ppe-name {
                font-weight: bold;
                font-size: 13px;
                color: #1e3a8a;
                margin-bottom: 4px;
            }
            .ppe-standard {
                font-size: 11px;
                color: #64748b;
            }
            .ppe-checkbox {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-top: 10px;
                padding: 8px;
                background: #f8fafc;
                border-radius: 4px;
            }
        </style>

        <div class="ppe-grid">
            <!-- Head Protection - MANDATORY -->
            <div class="ppe-card mandatory">
                <div class="ppe-header">
                    <div class="ppe-icon">ü™ñ</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Safety Helmet<span style="color: #dc2626;">*</span></div>
                        <div class="ppe-standard">EN 397</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_helmet" checked disabled>
                    <label for="ppe_helmet">Hard hat with chin strap</label>
                </div>
            </div>

            <!-- Foot Protection - MANDATORY -->
            <div class="ppe-card mandatory">
                <div class="ppe-header">
                    <div class="ppe-icon">ü•æ</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Safety Boots<span style="color: #dc2626;">*</span></div>
                        <div class="ppe-standard">EN 345 (S3)</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_boots" checked disabled>
                    <label for="ppe_boots">Steel toecap & midsole protection</label>
                </div>
            </div>

            <!-- Eye Protection (Spectacles) -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">üëì</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Safety Glasses</div>
                        <div class="ppe-standard">EN 166 1F</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_eye_spectacles">
                    <label for="ppe_eye_spectacles">Impact-resistant spectacles</label>
                </div>
            </div>

            <!-- Eye Protection (Goggles) -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">ü•Ω</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Safety Goggles</div>
                        <div class="ppe-standard">EN 166 1B</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_eye_goggles">
                    <label for="ppe_eye_goggles">High impact eye protection</label>
                </div>
            </div>

            <!-- Face Shield -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">üõ°Ô∏è</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Face Shield</div>
                        <div class="ppe-standard">EN 166 1B</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_face_shield">
                    <label for="ppe_face_shield">Full face protection</label>
                </div>
            </div>

            <!-- Hearing Protection (Ear Plugs) -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">üîå</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Ear Plugs</div>
                        <div class="ppe-standard">EN 352-2</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_ear_plugs">
                    <label for="ppe_ear_plugs">Disposable or reusable</label>
                </div>
            </div>

            <!-- Hearing Protection (Ear Muffs) -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">üéß</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Ear Defenders</div>
                        <div class="ppe-standard">EN 352-1</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_ear_muffs">
                    <label for="ppe_ear_muffs">Over-ear noise protection</label>
                </div>
            </div>

            <!-- Hand Protection (General) -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">üß§</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Work Gloves</div>
                        <div class="ppe-standard">EN 388</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_gloves_general">
                    <label for="ppe_gloves_general">General handling & grip</label>
                </div>
            </div>

            <!-- Hand Protection (Chemical) -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">üß™</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Chemical Gloves</div>
                        <div class="ppe-standard">EN 374-2/3</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_gloves_chemical">
                    <label for="ppe_gloves_chemical">Chemical resistant</label>
                </div>
            </div>

            <!-- Respiratory Protection (FFP1) -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">üò∑</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Dust Mask FFP1</div>
                        <div class="ppe-standard">EN 149 FFP1</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_dust_ffp1">
                    <label for="ppe_dust_ffp1">Low dust protection</label>
                </div>
            </div>

            <!-- Respiratory Protection (FFP2) -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">üò∑</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Face Mask FFP2</div>
                        <div class="ppe-standard">EN 149 FFP2</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_face_ffp2">
                    <label for="ppe_face_ffp2">Medium dust/aerosol protection</label>
                </div>
            </div>

            <!-- Respiratory Protection (FFP3) -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">üò∑</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Face Mask FFP3</div>
                        <div class="ppe-standard">EN 149 FFP3</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_face_ffp3">
                    <label for="ppe_face_ffp3">High dust/toxic particle protection</label>
                </div>
            </div>

            <!-- High Visibility Vest -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">ü¶∫</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Hi-Vis Vest</div>
                        <div class="ppe-standard">EN 471</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <label for="ppe_vest_yellow">Class 1 - Yellow vest</label>
                </div>
            </div>

            <!-- Hi-Vis Jacket (Yellow) -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">ü¶∫</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Hi-Vis Jacket</div>
                        <div class="ppe-standard">EN 471 Class 3</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_jacket_yellow">
                    <label for="ppe_jacket_yellow">Class 3 - Yellow jacket</label>
                </div>
            </div>

            <!-- Hi-Vis Vest (Orange/Banksman) -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">ü¶∫</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Banksman Vest</div>
                        <div class="ppe-standard">EN 471 Class 1</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_vest_orange">
                    <label for="ppe_vest_orange">Class 1 - Orange vest</label>
                </div>
            </div>

            <!-- Safety Harness -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">ü™¢</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Safety Harness</div>
                        <div class="ppe-standard">EN 361</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_harness">
                    <label for="ppe_harness">Full body fall arrest harness</label>
                </div>
            </div>

            <!-- Lanyard (Fixed Length) -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">üîó</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Fixed Lanyard</div>
                        <div class="ppe-standard">EN 354</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_lanyard_fixed">
                    <label for="ppe_lanyard_fixed">Fixed length restraint</label>
                </div>
            </div>

            <!-- Energy Absorbing Lanyard -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">üîó</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Shock Absorbing Lanyard</div>
                        <div class="ppe-standard">EN 354/355</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_lanyard_absorbing">
                    <label for="ppe_lanyard_absorbing">With energy absorber</label>
                </div>
            </div>

            <!-- Rope Access Equipment -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">ü™¢</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Rope Access Kit</div>
                        <div class="ppe-standard">EN 363</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_rope_access">
                    <label for="ppe_rope_access">Fall arrest system</label>
                </div>
            </div>

            <!-- Welding Mask -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">‚öíÔ∏è</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Welding Mask</div>
                        <div class="ppe-standard">EN 175/379</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_welding_mask">
                    <label for="ppe_welding_mask">Auto-darkening welding helmet</label>
                </div>
            </div>

            <!-- Lifejacket -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">üõü</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Lifejacket</div>
                        <div class="ppe-standard">EN ISO 12402</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_lifejacket">
                    <label for="ppe_lifejacket">Water work flotation device</label>
                </div>
            </div>

            <!-- Overalls -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">üë∑</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Work Overalls</div>
                        <div class="ppe-standard">General</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_overalls">
                    <label for="ppe_overalls">Protective coveralls</label>
                </div>
            </div>

            <!-- Task-Specific PPE -->
            <div class="ppe-card">
                <div class="ppe-header">
                    <div class="ppe-icon">üõ†Ô∏è</div>
                    <div class="ppe-info">
                        <div class="ppe-name">Task-Specific PPE</div>
                        <div class="ppe-standard">As Required</div>
                    </div>
                </div>
                <div class="ppe-checkbox">
                    <input type="checkbox" id="ppe_task_specific">
                    <label for="ppe_task_specific">Job-specific protection</label>
                </div>
            </div>
        </div>

        <div class="form-group" style="margin-top: 20px;">
            <label>Additional PPE Requirements or Notes:</label>
            <textarea class="form-control" rows="3" placeholder="List any other PPE requirements not covered above..."></textarea>
        </div>

        <div class="nav-buttons">
            <button class="btn btn-secondary" onclick="showTab(4)">‚¨Ö Previous</button>
            <button class="btn btn-primary" onclick="showTab(6)">Next ‚û°</button>
        </div>
    </div>

    <!-- Tab 6: Plant & Equipment -->
    <div class="tab-content" id="tab6">
        <div class="section-title">7. Plant, Equipment & Tools</div>
        
        <table id="equipment_table">
            <thead>
                <tr>
                    <th>Required</th>
                    <th>Equipment/Plant/Tool</th>
                    <th>Qty</th>
                    <th>Inspection/Certification</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input type="checkbox"></td>
                    <td>
                        <select class="form-control">
                            <option value="">Select from library...</option>
                            <option value="mewp">Mobile Elevating Work Platform (MEWP)</option>
                            <option value="scaffold">Mobile Scaffold Tower</option>
                            <option value="excavator">Excavator</option>
                            <option value="dumper">Dumper Truck</option>
                            <option value="telehandler">Telehandler</option>
                            <option value="crane">Crane</option>
                            <option value="generator">Generator</option>
                            <option value="compressor">Air Compressor</option>
                            <option value="saw">Concrete Saw</option>
                            <option value="drill">Drill/Breaker</option>
                            <option value="grinder">Angle Grinder</option>
                            <option value="ladder">Ladder</option>
                            <option value="steps">Podium Steps</option>
                            <option value="other">Other (specify)</option>
                        </select>
                    </td>
                    <td><input type="number" class="form-control" value="1" style="width: 60px;"></td>
                    <td><input type="text" class="form-control" placeholder="e.g., LOLER, Weekly inspection"></td>
                    <td><button class="delete-row-btn" onclick="deleteRow(this)">Delete</button></td>
                </tr>
            </tbody>
        </table>
        <button class="add-row-btn" onclick="addEquipmentRow()"><span style="font-size: 16px; color: white;">+</span> Add Equipment</button>

        <div class="form-group" style="margin-top: 20px;">
            <label>Add New Equipment to Library:</label>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="new_equipment" class="form-control" placeholder="Equipment name">
                <button class="btn btn-primary" onclick="addToEquipmentLibrary()">Add to Library</button>
            </div>
        </div>

        <div class="nav-buttons">
            <button class="btn btn-secondary" onclick="showTab(6)">‚¨Ö Previous</button>
            <button class="btn btn-primary" onclick="showTab(7)">Next ‚û°</button>
        </div>
    </div>

    <!-- Tab 7: Materials -->
    <div class="tab-content" id="tab7">
        <div class="section-title">8. Materials</div>
        
        <table id="materials_table">
            <thead>
                <tr>
                    <th>Material</th>
                    <th>Quantity/Unit</th>
                    <th>COSHH Required</th>
                    <th>Storage Requirements</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <select class="form-control">
                            <option value="">Select from library...</option>
                            <option value="concrete">Concrete/Cement</option>
                            <option value="aggregates">Aggregates/Stone</option>
                            <option value="steel">Steel/Reinforcement</option>
                            <option value="timber">Timber/Formwork</option>
                            <option value="paint">Paint/Coatings</option>
                            <option value="sealant">Sealants/Adhesives</option>
                            <option value="bricks">Bricks/Blocks</option>
                            <option value="roofing">Roofing Materials</option>
                            <option value="insulation">Insulation</option>
                            <option value="fuel">Fuel/Lubricants</option>
                            <option value="other">Other (specify)</option>
                        </select>
                    </td>
                    <td><input type="text" class="form-control" placeholder="e.g., 50 bags, 5m¬≥"></td>
                    <td>
                        <select class="form-control" style="width: 100px;">
                            <option value="yes">Yes</option>
                            <option value="no" selected>No</option>
                        </select>
                    </td>
                    <td><input type="text" class="form-control" placeholder="e.g., Dry, covered, secure"></td>
                    <td><button class="delete-row-btn" onclick="deleteRow(this)">Delete</button></td>
                </tr>
            </tbody>
        </table>
        <button class="add-row-btn" onclick="addMaterialRow()"><span style="font-size: 16px; color: white;">+</span> Add Material</button>

        <div class="form-group" style="margin-top: 20px;">
            <label>Add New Material to Library:</label>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="new_material" class="form-control" placeholder="Material name">
                <button class="btn btn-primary" onclick="addToMaterialLibrary()">Add to Library</button>
            </div>
        </div>

        <div class="nav-buttons">
            <button class="btn btn-secondary" onclick="showTab(6)">‚¨Ö Previous</button>
            <button class="btn btn-primary" onclick="showTab(8)">Next ‚û°</button>
        </div>
    </div>

    <!-- Tab 8: Sequence of Work -->
    <div class="tab-content" id="tab8">
        <div class="section-title">9. Sequence of Work</div>
        
        <div class="info-box">
            <strong>Instructions:</strong> List the work activities in sequential order with key control points.
        </div>

        <table id="sequence_table">
            <thead>
                <tr>
                    <th style="width: 60px;">Step</th>
                    <th>Activity Description</th>
                    <th>Key Controls/Checks</th>
                    <th style="width: 80px;">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td><textarea class="form-control" rows="2" placeholder="Describe activity step"></textarea></td>
                    <td><textarea class="form-control" rows="2" placeholder="Key controls for this step"></textarea></td>
                    <td><button class="delete-row-btn" onclick="deleteRow(this)">Delete</button></td>
                </tr>
                <tr>
                    <td>2</td>
                    <td><textarea class="form-control" rows="2" placeholder="Describe activity step"></textarea></td>
                    <td><textarea class="form-control" rows="2" placeholder="Key controls for this step"></textarea></td>
                    <td><button class="delete-row-btn" onclick="deleteRow(this)">Delete</button></td>
                </tr>
            </tbody>
        </table>
        <button class="add-row-btn" onclick="addSequenceRow()"><span style="font-size: 16px; color: white;">+</span> Add Step</button>

        <div class="nav-buttons">
            <button class="btn btn-secondary" onclick="showTab(7)">‚¨Ö Previous</button>
            <button class="btn btn-primary" onclick="showTab(9)">Next ‚û°</button>
        </div>
    </div>

    <!-- Tab 9: Emergency Procedures -->
    <div class="tab-content" id="tab9">
        <div class="section-title">10. Emergency Procedures</div>
        
        <div class="danger-box">
            <strong>üö® EMERGENCY CONTACTS</strong><br>
            Fire/Police/Ambulance: <strong>999</strong> or <strong>112</strong>
        </div>

        <div class="form-group">
            <label>Fire Emergency Procedures:</label>
            <textarea id="fire_procedure" class="textarea-large" rows="4" placeholder="Describe fire emergency procedures, evacuation routes, assembly points, fire extinguisher locations..."></textarea>
        </div>

        <div class="form-group">
            <label>First Aid Emergency Procedures:</label>
            <textarea id="first_aid_procedure" class="textarea-large" rows="4" placeholder="Describe first aid procedures, first aider contacts, first aid kit locations..."></textarea>
        </div>

        <div class="form-group">
            <label>Accident/Incident Reporting:</label>
            <textarea id="incident_procedure" class="textarea-large" rows="4" placeholder="Describe accident/incident reporting procedures, who to contact, forms to complete..."></textarea>
        </div>

        <div class="form-group">
            <label>Spillage/Environmental Emergency:</label>
            <textarea id="spill_procedure" class="textarea-large" rows="4" placeholder="Describe procedures for dealing with spills, environmental incidents, containment measures..."></textarea>
        </div>

        <div class="form-group">
            <label>Site Evacuation Procedure:</label>
            <textarea id="evacuation_procedure" class="textarea-large" rows="4" placeholder="Describe site evacuation procedures, assembly points, roll call procedures..."></textarea>
        </div>

        <div class="nav-buttons">
            <button class="btn btn-secondary" onclick="showTab(8)">‚¨Ö Previous</button>
            <button class="btn btn-primary" onclick="showTab(10)">Next ‚û°</button>
        </div>
    </div>

    <!-- Tab 10: Environmental Controls -->
    <div class="tab-content" id="tab10">
        <div class="section-title">11. Environmental Controls</div>
        
        <div class="form-group">
            <label>Waste Management:</label>
            <textarea id="waste_management" class="textarea-large" rows="3" placeholder="Describe waste segregation, disposal methods, waste transfer notes..."></textarea>
        </div>

        <div class="form-group">
            <label>Housekeeping Standards:</label>
            <textarea id="housekeeping" class="textarea-large" rows="3" placeholder="Describe housekeeping requirements, cleaning schedules, tidy as you go policies..."></textarea>
        </div>

        <div class="form-group">
            <label>Noise Control Measures:</label>
            <textarea id="noise_control" class="textarea-large" rows="3" placeholder="Describe noise monitoring, working hours restrictions, noise reduction measures..."></textarea>
        </div>

        <div class="form-group">
            <label>Dust & Fume Control:</label>
            <textarea id="dust_control" class="textarea-large" rows="3" placeholder="Describe dust suppression measures, water spraying, extraction systems..."></textarea>
        </div>

        <div class="form-group">
            <label>Water Pollution Prevention:</label>
            <textarea id="water_pollution" class="textarea-large" rows="3" placeholder="Describe measures to prevent water pollution, drainage protection, spill kits..."></textarea>
        </div>

        <div class="form-group">
            <label>Vibration Control:</label>
            <textarea id="vibration_control" class="textarea-large" rows="3" placeholder="Describe vibration monitoring, equipment selection, working methods..."></textarea>
        </div>

        <div class="nav-buttons">
            <button class="btn btn-secondary" onclick="showTab(9)">‚¨Ö Previous</button>
            <button class="btn btn-primary" onclick="showTab(11)">Next ‚û°</button>
        </div>
    </div>

    <!-- Tab 11: Sign-off & Approval -->
    <div class="tab-content" id="tab11">
        <div class="section-title">12. Sign-off & Approval</div>
        
        <div class="warning-box">
            <strong>‚ö†Ô∏è IMPORTANT:</strong> This RAMS must be reviewed and approved before work commences. All personnel must be briefed on the contents before starting work.
        </div>

        <table>
            <thead>
                <tr>
                    <th colspan="4" style="text-align: center; background: #1e3a8a;">Method Statement Prepared By</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Name:</strong></td>
                    <td><input type="text" id="prepared_name" class="form-control"></td>
                    <td><strong>Position:</strong></td>
                    <td><input type="text" id="prepared_position" class="form-control"></td>
                </tr>
                <tr>
                    <td><strong>Signature:</strong></td>
                    <td><input type="text" id="prepared_signature" class="form-control" placeholder="Type name"></td>
                    <td><strong>Date:</strong></td>
                    <td><input type="date" id="prepared_date" class="form-control"></td>
                </tr>
            </tbody>
        </table>

        <table style="margin-top: 20px;">
            <thead>
                <tr>
                    <th colspan="4" style="text-align: center; background: #1e3a8a;">Reviewed & Approved By (HSQE Consultant)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Name:</strong></td>
                    <td><input type="text" id="approved_name" class="form-control" value="Jeremy Bromley"></td>
                    <td><strong>Position:</strong></td>
                    <td><input type="text" id="approved_position" class="form-control" value="HSQE Consultant"></td>
                </tr>
                <tr>
                    <td><strong>Signature:</strong></td>
                    <td><input type="text" id="approved_signature" class="form-control" placeholder="Type name"></td>
                    <td><strong>Date:</strong></td>
                    <td><input type="date" id="approved_date" class="form-control"></td>
                </tr>
            </tbody>
        </table>

        <table style="margin-top: 20px;">
            <thead>
                <tr>
                    <th colspan="4" style="text-align: center; background: #1e3a8a;">Accepted By (Client/Principal Contractor)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Name:</strong></td>
                    <td><input type="text" id="accepted_name" class="form-control"></td>
                    <td><strong>Position:</strong></td>
                    <td><input type="text" id="accepted_position" class="form-control"></td>
                </tr>
                <tr>
                    <td><strong>Signature:</strong></td>
                    <td><input type="text" id="accepted_signature" class="form-control" placeholder="Type name"></td>
                    <td><strong>Date:</strong></td>
                    <td><input type="date" id="accepted_date" class="form-control"></td>
                </tr>
            </tbody>
        </table>

        <div class="section-title" style="margin-top: 25px;">Review Schedule</div>
        
        <div class="form-group">
            <label>Review Frequency:</label>
            <select id="review_frequency" class="form-control">
                <option value="monthly">Monthly</option>
                <option value="quarterly" selected>Every 3 Months</option>
                <option value="biannual">Every 6 Months</option>
                <option value="annual">Annually</option>
                <option value="as_needed">As Required</option>
            </select>
        </div>

        <div class="form-group">
            <label>Next Review Date:</label>
            <input type="date" id="next_review" class="form-control">
        </div>

        <div class="form-group">
            <label>Persons Authorized to Update/Amend:</label>
            <textarea id="authorized_persons" class="textarea-large" rows="2" placeholder="Names and positions of persons authorized to update this RAMS"></textarea>
        </div>

        <div class="nav-buttons">
            <button class="btn btn-secondary" onclick="showTab(9)">‚¨Ö Previous</button>
            <button class="btn btn-primary" disabled style="opacity: 0.5;">Complete ‚úì</button>
        </div>
    </div>

    <!-- Action Buttons at Bottom -->
    <div class="action-buttons" style="margin-top: 30px; margin-bottom: 20px;">
        <button class="btn btn-primary" onclick="generatePDF()">üìÑ Export to PDF</button>
        <button class="btn btn-primary" onclick="emailDocument()">üìß Email Document</button>
        <button class="btn btn-secondary" onclick="downloadHTML()">üíæ Download HTML</button>
        <button class="btn btn-secondary" onclick="saveToLocalStorage()">üíø Save Progress</button>
        <button class="btn btn-secondary" onclick="loadFromLocalStorage()">üìÇ Load Saved</button>
    </div>

    <script>
        // Info Panel Toggle Functions
        function toggleInfoPanel(side) {
            const panel = document.getElementById(`info-panel-${side}`);
            const otherPanel = document.getElementById(`info-panel-${side === 'left' ? 'right' : 'left'}`);
            
            // Close other panel
            otherPanel.classList.remove('show');
            
            // Toggle this panel
            panel.classList.toggle('show');
        }

        function closeInfoPanel(side) {
            const panel = document.getElementById(`info-panel-${side}`);
            panel.classList.remove('show');
        }

        // Close panels when clicking outside
        document.addEventListener('click', function(event) {
            const leftPanel = document.getElementById('info-panel-left');
            const rightPanel = document.getElementById('info-panel-right');
            const leftCorner = document.querySelector('.info-corner.top-left');
            const rightCorner = document.querySelector('.info-corner.top-right');
            
            if (!leftPanel.contains(event.target) && !leftCorner.contains(event.target)) {
                leftPanel.classList.remove('show');
            }
            if (!rightPanel.contains(event.target) && !rightCorner.contains(event.target)) {
                rightPanel.classList.remove('show');
            }
        });

        // Tab Navigation
        function showTab(tabNum) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-button');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(`tab${tabNum}`).classList.add('active');
            buttons[tabNum - 1].classList.add('active');
            
            document.getElementById('progress-text').textContent = `Tab ${tabNum} of 11`;
            window.scrollTo(0, 0);
        }

        // Dynamic Row Functions
        function deleteRow(btn) {
            btn.closest('tr').remove();
        }

        function addDistributionRow() {
            const table = document.getElementById('distribution_table').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="text" class="form-control" placeholder="Name"></td>
                <td><input type="text" class="form-control" placeholder="Position/Company"></td>
                <td><input type="email" class="form-control" placeholder="Email address"></td>
                <td><button class="delete-row-btn" onclick="deleteRow(this)">Delete</button></td>
            `;
        }

        function addRARow() {
            const table = document.getElementById('ra_table').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="text" class="form-control" placeholder="e.g., Working at Height"></td>
                <td><input type="text" class="form-control" placeholder="e.g., RA-001"></td>
                <td><button class="delete-row-btn" onclick="deleteRow(this)">Delete</button></td>
            `;
        }

        function addCOSHHRow() {
            const table = document.getElementById('coshh_table').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="text" class="form-control" placeholder="e.g., Cement/Concrete"></td>
                <td><input type="text" class="form-control" placeholder="e.g., COSHH-001"></td>
                <td><button class="delete-row-btn" onclick="deleteRow(this)">Delete</button></td>
            `;
        }

        let riskAssessmentCounter = 1;
        function addRiskMatrixRow() {
            const tbody = document.getElementById("risk_matrix_tbody");
            const newRow = tbody.rows[0].cloneNode(true);
            
            // Clear all input values in cloned row
            newRow.querySelectorAll("input, select, textarea").forEach(el => {
                if (el.type === "checkbox") el.checked = false;
                else el.value = "";
            });
            
            // Reset risk scores
            newRow.querySelectorAll(".risk-score").forEach(el => {
                el.style.background = "#e5e7eb";
                el.style.color = "#6b7280";
                el.textContent = "-";
            });
            
            tbody.appendChild(newRow);
        }


        function addRiskAssessment() {
            const container = document.getElementById('risk_assessments_container');
            const assessmentDiv = document.createElement('div');
            assessmentDiv.className = 'risk-assessment-block';
            assessmentDiv.style.cssText = 'border: 2px solid #cbd5e1; padding: 20px; margin: 20px 0; border-radius: 8px; background: #f8fafc;';
            assessmentDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; color: #1e3a8a; font-size: 14px;">Risk Assessment #${riskAssessmentCounter}</h3>
                    <button class="delete-row-btn" onclick="this.closest('.risk-assessment-block').remove()">Delete Assessment</button>
                </div>
                <div class="form-group">
                    <label>Hazard Description:</label>
                    <textarea class="form-control" rows="2" placeholder="Describe the hazard..."></textarea>
                </div>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>Initial Probability (1-3):</label>
                        <select class="form-control init-prob" onchange="calculateInitialRisk(this)">
                            <option value="1">1 - Unlikely</option>
                            <option value="2">2 - Likely</option>
                            <option value="3">3 - Inevitable</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Initial Severity (1-3):</label>
                        <select class="form-control init-sev" onchange="calculateInitialRisk(this)">
                            <option value="1">1 - Slight/None</option>
                            <option value="2">2 - Minor/Serious</option>
                            <option value="3">3 - Fatal/Major</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Initial Risk Score:</label>
                        <input type="text" class="form-control init-score" readonly style="font-weight: bold; text-align: center;">
                    </div>
                </div>
                <div class="form-group">
                    <label>Control Measures:</label>
                    <textarea class="form-control" rows="3" placeholder="Describe control measures to be implemented..."></textarea>
                </div>
                <div class="form-row-3">
                    <div class="form-group">
                        <label>Residual Probability (1-3):</label>
                        <select class="form-control res-prob" onchange="calculateResidualRisk(this)">
                            <option value="1" selected>1 - Unlikely</option>
                            <option value="2">2 - Likely</option>
                            <option value="3">3 - Inevitable</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Residual Severity (1-3):</label>
                        <select class="form-control res-sev" onchange="calculateResidualRisk(this)">
                            <option value="1" selected>1 - Slight/None</option>
                            <option value="2">2 - Minor/Serious</option>
                            <option value="3">3 - Fatal/Major</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Residual Risk Score:</label>
                        <input type="text" class="form-control res-score" readonly style="font-weight: bold; text-align: center;">
                    </div>
                </div>
            `;
            container.appendChild(assessmentDiv);
            riskAssessmentCounter++;
        }

        function calculateInitialRisk(select) {
            const block = select.closest('.risk-assessment-block');
            const prob = parseInt(block.querySelector('.init-prob').value);
            const sev = parseInt(block.querySelector('.init-sev').value);
            const score = prob * sev;
            const scoreInput = block.querySelector('.init-score');
            scoreInput.value = score;
            
            if (score >= 6) {
                scoreInput.style.background = '#fee2e2';
                scoreInput.style.color = '#dc2626';
            } else if (score >= 4) {
                scoreInput.style.background = '#fef3c7';
                scoreInput.style.color = '#f59e0b';
            } else {
                scoreInput.style.background = '#dcfce7';
                scoreInput.style.color = '#10b981';
            }
        }

        function calculateResidualRisk(select) {
            const block = select.closest('.risk-assessment-block');
            const prob = parseInt(block.querySelector('.res-prob').value);
            const sev = parseInt(block.querySelector('.res-sev').value);
            const score = prob * sev;
            const scoreInput = block.querySelector('.res-score');
            scoreInput.value = score;
            
            if (score >= 6) {
                scoreInput.style.background = '#fee2e2';
                scoreInput.style.color = '#dc2626';
            } else if (score >= 4) {
                scoreInput.style.background = '#fef3c7';
                scoreInput.style.color = '#f59e0b';
            } else {
                scoreInput.style.background = '#dcfce7';
                scoreInput.style.color = '#10b981';
            }
        }

        // Initialize with one risk assessment
        document.addEventListener('DOMContentLoaded', function() {
            addRiskAssessment();
        });

        function addRiskRow() {
            const table = document.getElementById('risk_table').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="text" class="form-control" placeholder="Hazard description"></td>
                <td>
                    <select class="form-control" onchange="calculateRisk(this)">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </td>
                <td>
                    <select class="form-control" onchange="calculateRisk(this)">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </td>
                <td><input type="text" class="form-control" readonly></td>
                <td><textarea class="form-control" rows="2" placeholder="Control measures"></textarea></td>
                <td>
                    <select class="form-control" onchange="calculateResidualRisk(this)">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </td>
                <td>
                    <select class="form-control" onchange="calculateResidualRisk(this)">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </td>
                <td><input type="text" class="form-control" readonly></td>
                <td><button class="delete-row-btn" onclick="deleteRow(this)">Delete</button></td>
            `;
        }

        function calculateRisk(select) {
            const row = select.closest('tr');
            const prob = parseInt(row.cells[1].querySelector('select').value);
            const sev = parseInt(row.cells[2].querySelector('select').value);
            const score = prob * sev;
            row.cells[3].querySelector('input').value = score;
            
            // Color code the score
            const scoreInput = row.cells[3].querySelector('input');
            if (score >= 6) {
                scoreInput.style.background = '#fee2e2';
                scoreInput.style.fontWeight = 'bold';
            } else if (score >= 4) {
                scoreInput.style.background = '#fef3c7';
            } else {
                scoreInput.style.background = '#dcfce7';
            }
        }

        function calculateResidualRisk(select) {
            const row = select.closest('tr');
            const prob = parseInt(row.cells[5].querySelector('select').value);
            const sev = parseInt(row.cells[6].querySelector('select').value);
            const score = prob * sev;
            row.cells[7].querySelector('input').value = score;
            
            // Color code the score
            const scoreInput = row.cells[7].querySelector('input');
            if (score >= 6) {
                scoreInput.style.background = '#fee2e2';
                scoreInput.style.fontWeight = 'bold';
            } else if (score >= 4) {
                scoreInput.style.background = '#fef3c7';
            } else {
                scoreInput.style.background = '#dcfce7';
            }
        }

        function addEquipmentRow() {
            const table = document.getElementById('equipment_table').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="checkbox"></td>
                <td>
                    <select class="form-control">
                        <option value="">Select from library...</option>
                        <option value="mewp">Mobile Elevating Work Platform (MEWP)</option>
                        <option value="scaffold">Mobile Scaffold Tower</option>
                        <option value="excavator">Excavator</option>
                        <option value="dumper">Dumper Truck</option>
                        <option value="telehandler">Telehandler</option>
                        <option value="crane">Crane</option>
                        <option value="generator">Generator</option>
                        <option value="compressor">Air Compressor</option>
                        <option value="saw">Concrete Saw</option>
                        <option value="drill">Drill/Breaker</option>
                        <option value="grinder">Angle Grinder</option>
                        <option value="ladder">Ladder</option>
                        <option value="steps">Podium Steps</option>
                        <option value="other">Other (specify)</option>
                    </select>
                </td>
                <td><input type="number" class="form-control" value="1" style="width: 60px;"></td>
                <td><input type="text" class="form-control" placeholder="e.g., LOLER, Weekly inspection"></td>
                <td><button class="delete-row-btn" onclick="deleteRow(this)">Delete</button></td>
            `;
        }

        function addMaterialRow() {
            const table = document.getElementById('materials_table').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td>
                    <select class="form-control">
                        <option value="">Select from library...</option>
                        <option value="concrete">Concrete/Cement</option>
                        <option value="aggregates">Aggregates/Stone</option>
                        <option value="steel">Steel/Reinforcement</option>
                        <option value="timber">Timber/Formwork</option>
                        <option value="paint">Paint/Coatings</option>
                        <option value="sealant">Sealants/Adhesives</option>
                        <option value="bricks">Bricks/Blocks</option>
                        <option value="roofing">Roofing Materials</option>
                        <option value="insulation">Insulation</option>
                        <option value="fuel">Fuel/Lubricants</option>
                        <option value="other">Other (specify)</option>
                    </select>
                </td>
                <td><input type="text" class="form-control" placeholder="e.g., 50 bags, 5m¬≥"></td>
                <td>
                    <select class="form-control" style="width: 100px;">
                        <option value="yes">Yes</option>
                        <option value="no" selected>No</option>
                    </select>
                </td>
                <td><input type="text" class="form-control" placeholder="e.g., Dry, covered, secure"></td>
                <td><button class="delete-row-btn" onclick="deleteRow(this)">Delete</button></td>
            `;
        }

        function addSequenceRow() {
            const table = document.getElementById('sequence_table').getElementsByTagName('tbody')[0];
            const rowCount = table.rows.length;
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td>${rowCount + 1}</td>
                <td><textarea class="form-control" rows="2" placeholder="Describe activity step"></textarea></td>
                <td><textarea class="form-control" rows="2" placeholder="Key controls for this step"></textarea></td>
                <td><button class="delete-row-btn" onclick="deleteRow(this)">Delete</button></td>
            `;
        }

        function addControlMeasure() {
            const input = document.getElementById('new_control');
            if (input.value.trim() !== '') {
                const library = document.getElementById('control_library');
                const newControl = document.createElement('div');
                newControl.style.cssText = 'padding: 8px; background: #f8fafc; border-radius: 4px; font-size: 12px;';
                newControl.textContent = `‚úì ${input.value}`;
                library.appendChild(newControl);
                input.value = '';
            }
        }

        function addToEquipmentLibrary() {
            const input = document.getElementById('new_equipment');
            if (input.value.trim() !== '') {
                alert(`"${input.value}" has been added to equipment library`);
                input.value = '';
            }
        }

        function addToMaterialLibrary() {
            const input = document.getElementById('new_material');
            if (input.value.trim() !== '') {
                alert(`"${input.value}" has been added to materials library`);
                input.value = '';
            }
        }

        // Save/Load Functions
        function saveToLocalStorage() {
            const formData = {};
            document.querySelectorAll('input, select, textarea').forEach(elem => {
                if (elem.id) {
                    formData[elem.id] = elem.value;
                }
            });
            localStorage.setItem('rams_data', JSON.stringify(formData));
            alert('‚úì Progress saved successfully!');
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('rams_data');
            if (saved) {
                const formData = JSON.parse(saved);
                Object.keys(formData).forEach(key => {
                    const elem = document.getElementById(key);
                    if (elem) {
                        elem.value = formData[key];
                    }
                });
                alert('‚úì Saved data loaded successfully!');
            } else {
                alert('No saved data found.');
            }
        }

        // PDF Export Function
        async function generatePDF() {
            alert('üìÑ Generating PDF... This may take a moment.');
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const tabs = document.querySelectorAll('.tab-content');
            
            let pageNum = 0;
            
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].style.display = 'block';
                
                const canvas = await html2canvas(tabs[i], {
                    scale: 2,
                    logging: false,
                    useCORS: true
                });
                
                const imgData = canvas.toDataURL('image/jpeg', 0.8);
                const imgWidth = 190;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                if (pageNum > 0) {
                    pdf.addPage();
                }
                
                pdf.addImage(imgData, 'JPEG', 10, 10, imgWidth, imgHeight);
                pdf.setFontSize(8);
                pdf.text(`Page ${pageNum + 1} of ${tabs.length}`, 105, 290, { align: 'center' });
                
                tabs[i].style.display = 'none';
                pageNum++;
            }
            
            // Restore active tab
            showTab(1);
            
            const filename = `CSS-RAMS-${document.getElementById('doc_ref').value || '001'}.pdf`;
            pdf.save(filename);
            alert('‚úì PDF generated successfully!');
        }

        // Email Function
        function emailDocument() {
            const subject = encodeURIComponent(`RAMS Document - ${document.getElementById('rams_title').value || 'CSS-RAMS-001'}`);
            const body = encodeURIComponent('Please find attached the Risk Assessment & Method Statement.\n\nThis document has been prepared by Common Sense Safety.\n\nBest regards');
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
        }

        // Download HTML Function
        function downloadHTML() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `CSS-RAMS-${document.getElementById('doc_ref').value || '001'}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('‚úì HTML file downloaded successfully!');
        }

        // Auto-save every 2 minutes
        setInterval(() => {
            saveToLocalStorage();
            console.log('Auto-saved at:', new Date().toLocaleTimeString());
        }, 120000);

        // Load saved data on page load
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('rams_data');
            if (saved && confirm('Saved data found. Would you like to load it?')) {
                loadFromLocalStorage();
            }
        });
    </script>
</body>
</html>